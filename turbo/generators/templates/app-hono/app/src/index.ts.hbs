import { logger } from '@mizu/logger'
import { {{ camelCase name }}EnvConfig } from '@mizu/{{ name }}-config'
import { appRouter, createContext } from '@mizu/{{ name }}-trpc'
import { trpcServer } from '@hono/trpc-server'
import { Hono } from 'hono'
import { cors } from 'hono/cors'
import { logger as honoLogger } from 'hono/logger'

/**
 * âœ§ï½¥ï¾Ÿ: *âœ§ï½¥ï¾Ÿ:* {{ constantCase name }} HONO SERVER *:ï½¥ï¾Ÿâœ§*:ï½¥ï¾Ÿâœ§
 *
 * A lightweight API server powered by Hono! (â—•â€¿â—•âœ¿)
 */

const app = new Hono()

// Middleware
app.use('*', honoLogger())
app.use('*', cors({
  origin: {{ camelCase name }}EnvConfig.app.cors,
  credentials: true,
}))

// Health check endpoint
app.get('/health', (c) => {
  return c.json({ status: 'ok', timestamp: new Date().toISOString() })
})

// tRPC endpoint
app.use(
  '/api/trpc/*',
  trpcServer({
    router: appRouter,
    createContext,
  })
)

// Start server
const port = {{ camelCase name }}EnvConfig.app.port

logger.info({ port, url: `http://localhost:${port}` }, 'ðŸš€ {{ pascalCase name }} Hono server started')

export default {
  port,
  fetch: app.fetch,
}

